<%= cable_ready_updates_for @retreat do %>


<% if false %>
<% checks = Flights::Check.create!(team_id: current_team.id, name: "Pizza", flight_id: Flight.first.id, retreat_id: @retreat.id) %>
<% checks = Flights::Check.create!(team_id: current_team.id, name: "Pizza2", flight_id: Flight.second.id, retreat_id: @retreat.id) %>
<% checks = Flights::Check.create!(team_id: current_team.id, name: "Pizza3", flight_id: Flight.last.id, retreat_id: @retreat.id) %>
<% checks = Flights::Check.create!(team_id: current_team.id, name: "Pizza4", flight_id: Flight.first.id, retreat_id: @retreat.id) %>
<% end %>


<% with_attribute_settings object: @retreat do %>
    <div class="w-full bg-white p-4 rounded-lg shadow-md flex flex-col lg:flex-row gap-4">
  <!-- Left Box (Details Section) -->
  <div class="flex-1">
    <h1 class="text-3xl font-bold text-blue-600">
      <%# render 'shared/attributes/text', attribute: :name %>
      <%  if can? :edit, @retreat %>
        <%= link_to @retreat.name, [:edit, :account, @retreat] %>
      <% else %>
        <%= render 'shared/attributes/text', attribute: :name %>
      <% end %>
    </h1>
    <p class="text-gray-600 mt-2">
      <%= render 'shared/attributes/text', attribute: :description %>
    </p>

    <p class="mt-4">
      <strong>Itinerary:</strong> <%= @retreat.id %>
    </p>
    <p>
      <strong>Arriving:</strong> <%= @retreat.arrival.in_time_zone("America/Los_Angeles").strftime("%A %B #{@retreat.arrival.day.ordinalize} %-l:%M%P") %>
    </p>
    <p>
      <strong>Departing:</strong> <%= @retreat.departure.in_time_zone("America/Los_Angeles").strftime("%A %B #{@retreat.departure.day.ordinalize} %-l:%M%P") %>
    </p>
    <p>
      <strong>Details:</strong> <%= @retreat.demographics.map { |d| d.name }.to_sentence %> <%= pluralize((@retreat.departure&.to_date - @retreat.arrival&.to_date).to_i, "Night") %>, <%# pluralize(@meals.count, "Meal") %>  ADD MEAL COUNT
    </p>

    <p class="mt-4">
      <strong>Meeting Spaces:</strong> Chipmunk Corner and Hormel Hall: Auditorium (0.0% Clean)
    </p>
    <p>
      <strong>Lodging:</strong> 12-A, 12-B, 16-A, 16-B, 17-A, 17-B, 46-A, 46-B, 47-A, 47-B, 48-A, 48-B, 49-B, 53-A, 53-B, 80- A, 80- B, 81- A, 81- B, 82- B, 83- A, 83- B, 84- B, 85- A, 85-B, and Biltmore Cabin (17.95% Clean)
    </p>

  <p class="mt-4"></p>
      <strong>Special Diets: </strong> 
      <ul class="list-disc list-inside">
        <li>No appears <strong>67 times</strong></li>
        <li>Yes, I am Egg Free appears <strong>2 times</strong></li>
        <li>Yes, I am Gluten Free appears <strong>5 times</strong></li>
        <li>Yes, I am Gluten Free and Dairy Free appears <strong>1 time</strong></li>
    </ul>
    </p>

  </div>
  <!-- Location icons aligned at the bottom -->
  <p class="flex -space-x-4">
    <% @retreat.locations.each do |location| %>
      <%= image_tag location_icon_url(location), class: 'inline-block h-10 w-10 rounded-full ring-2 ring-white self-end', alt: location&.name %>
    <% end %>
  </p>
<% end ### with attributes settting %>  



  <div class="flex flex-col gap-4">
    
    <div class="bg-gray-100 p-4 rounded-lg">

      <h2 class="text-2xl font-bold text-gray-800">91 Guests</h2>
     
      <p><strong>Group Leaders: </strong><%= @retreat.contacts.present? ? @retreat.contacts.map { |p| p.full_name }.to_sentence : "Not Assigned" %></p>
      <p><strong>Event Planners: </strong><%= @retreat.planners.present? ? @retreat.planners.map { |p| p.full_name }.to_sentence : "Not Assigned" %></p>
      <p><strong>Hosts: </strong><%= @retreat.hosts.present? ? @retreat.hosts.map { |p| p.full_name }.to_sentence : "Not Assigned" %></p>
      <p><strong>Registraions: </strong>67 Registered, 45%</p>
    </div>

    <!-- Buttons Section -->
    <div class="flex flex-col gap-2">
      <%= link_to "Add New Reservation", [:new, :account, current_team, :reservation, { retreat_id: @retreat.id }], class: "bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 hover:no-underline hover:text-white" %>
      <%= link_to "Group Page", root_path(retreat_id: @retreat.id), class: "bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 hover:no-underline hover:text-white" %>
      <% if can? :create, Season.new(team: current_team) %>
          <% if @seasonal %>
           <%= link_to "Remove Seasonal Defaults", account_team_remove_seasonal_reservations_path(team_id: current_team.id, retreat_id: @retreat.id), data: { confirm: "Are you sure you want to remove all Seasonal Defaults to the group?  This will permantently remove them and they cannot be recovered.  You will be able to readd them from scratch." }, class: "bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 hover:no-underline  hover:text-white" %>
          <% else %>
            <%= link_to "Add Seasonal Defaults", account_team_create_seasonal_reservations_path(team_id: current_team.id, retreat_id: @retreat.id), data: { confirm: "Are you sure you want to add Seasonal Defaults to the group?" }, class: "bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 hover:no-underline hover:text-white" %> 
          <% end %> 
       <% end %>
      <%= link_to "Printable schedule", account_team_print_retreat_path(team_id: @retreat.team_id, retreat_id: @retreat.id), class: "bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600  hover:text-white hover:no-underline" %>
    </div>
  </div>


</div>

<div class="mb-4"></div>

<div class="bg-white p-6 rounded-lg shadow-md w-full mb-4">
  <h2 class="text-xl font-bold text-gray-700 mb-4">Calendar</h2>
    <%= render 'account/retreats/schedule' %> 
</div>



<div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full mb-4">
  <!-- First Box -->
  <div class="bg-white p-6 rounded-lg shadow-md w-full flex flex-col justify-between h-full">
    <div>
      <h2 class="text-xl font-bold text-gray-700 mb-4">Open Flights</h2>
      <!-- Content for the first box goes here -->
      <%= render 'account/retreats/flights', checks: Flights::Check.where(retreat_id: @retreat.id).where(completed_at: nil), hide_back: true %>
    </div>    
  </div>

  <!-- Second Box -->
  <div class="bg-white p-6 rounded-lg shadow-md w-full flex flex-col justify-between h-full">
    <div>
      <h2 class="text-xl font-bold text-gray-700 mb-4">Closed Flight</h2>
      <!-- Content for the second box goes here -->
      <%= render 'account/retreats/flights', checks: Flights::Check.where(retreat_id: @retreat.id).where.not(completed_at: nil), hide_back: true %>
    </div>
  </div>
</div>





<% if false ##Origainal Code %>
      <%= render 'account/shared/box', divider: true do |box| %>
        <% box.title t('.header') %>
        <% box.description do %>
          <%= t('.description') %>
          <%= t('.manage_description') if can? :manage, @retreat %>
        <% end %>



        <% box.body do %>
          <% with_attribute_settings object: @retreat, strategy: :label do %>
            <%= render 'shared/attributes/text', attribute: :name %>
            <%= render 'shared/attributes/text', attribute: :description %>
            <%= render 'shared/attributes/date_and_time', attribute: :arrival %>
            <%= render 'shared/attributes/date_and_time', attribute: :departure %>
            <%= render 'shared/attributes/number', attribute: :guest_count %>
            <%= render 'shared/attributes/belongs_to', attribute: :organization %>
            <%= render 'shared/attributes/option', attribute: :internal %>
            <%= render 'shared/attributes/option', attribute: :active %>
            <%= render 'shared/attributes/text', attribute: :jotform %>
            <%= render 'shared/attributes/has_many', attribute: :locations %>
            <%= render 'shared/attributes/has_many', attribute: :demographics %>
            <%= render 'shared/attributes/has_many', attribute: :planners %>
            <%= render 'shared/attributes/has_many', attribute: :hosts %>
            <%= render 'shared/attributes/has_many', attribute: :contacts %>
            <%# ðŸš… super scaffolding will insert new fields above this line. %>
          <% end %>
        <% end %>
      


        <% box.actions do %>
          <%= link_to t('.buttons.edit'), [:edit, :account, @retreat], class: first_button_primary if can? :edit, @retreat %>
          <%# ðŸš… super scaffolding will insert new action model buttons above this line. %>
          <%= button_to t('.buttons.destroy'), [:account, @retreat], method: :delete, class: first_button_primary, data: { confirm: t('.buttons.confirmations.destroy', model_locales(@retreat)) } if can? :destroy, @retreat %>
          <%= link_to t('global.buttons.back'), [:account, @team, :retreats], class: first_button_primary %>
        <% end %>

        <% box.raw_footer do %>
          <%# ðŸš… super scaffolding will insert new action model index views above this line. %>
        <% end %>
      <% end %>
    <% end %>
<% end ## orignal BT code %>  

<%= render 'account/retreats/requests/index', requests: @retreat.requests, hide_back: true %>
<br/>
  <% if can? :edit, @retreat %>
    <%= render 'account/retreats/comments/index', comments: @retreat.comments, hide_back: true %>
    <%# ðŸš… super scaffolding will insert new children above this line. %>


      <div class="bg-white p-6 rounded-lg shadow-md w-full mt-4">
        <h2 class="text-xl font-bold text-gray-700 mb-4">Papertrail</h2>
        <%= render 'account/retreats/papertrail' %>
      </div>
  <% end %>


